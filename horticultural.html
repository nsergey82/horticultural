<head>
    <script src="https://unpkg.com/kaplay@3001.0.19/dist/kaplay.js"></script>
    <script src="game.js"></script>
    <script src="rendering.js"></script>
</head>

<body>
    <script>
        const k = kaplay({
            background: "#a4a4b3",
            global: false,
            debug: true,
        });

        const SEEDS_TAG = "seeds";
        const PLOUGHED_TAG = "ploughed";

        k.loadSprite("dirt", "dirt_t.png");
        k.loadSprite(PLOUGHED_TAG, "ploughed_t.png");
        k.loadSprite(SEEDS_TAG, "seeds_a.png", {
            sliceX: 4,
            sliceY: 1,
        });

        // Rendering constants
        const TILE_SZ = 48;
        const DIRT_S = k.Color.fromHex("#C4A484");

        function emptyTileDrawer() {
            return [
                k.sprite("dirt"),
                k.area(),
                k.body(),
                TILE_T,
            ];
        }

        const gameState = new GameState();

        const level = k.addLevel(gameState.toArrayOfStrings(), {
            tileWidth: TILE_SZ,
            tileHeight: TILE_SZ,
            // The position of the top left block
            pos: k.vec2(50, 50),
            tiles: {
                " ": emptyTileDrawer
            },
        })

        const toolLabel = k.add([
            k.pos(50, TILE_SZ * (gameState.field.length + 1)),
            k.text("current tool: plough", {
                size: 18, // 48 pixels tall
                width: 320, // it'll wrap to next line when width exceeds this value
                font: "sans-serif", // specify any font you loaded or browser built-in
            }),
        ])
        const cropsLabel = k.add([
            k.pos(50, TILE_SZ * (gameState.field.length + 2)),
            k.text("crops collected: 0", {
                size: 18, // 48 pixels tall
                width: 320, // it'll wrap to next line when width exceeds this value
                font: "sans-serif", // specify any font you loaded or browser built-in
            }),
        ])

        k.onClick(TILE_T, (tile) => {
            const gtile = gameState.applyTool(tile.tilePos.y, tile.tilePos.x);
            tileToRender(k, gtile, tile)
            cropsLabel.text = "crops collected: " + gameState.collected;
        });

        k.onKeyPress("n", () => {
            toolLabel.text = "current tool: " + gameState.nextTool();
        });


        /*
        The cycle of life:
        dirt -> ploughed -> planted -> watered1 -> watered2 ... wateredk -> ripe -> dirt
        */
    </script>
</body>